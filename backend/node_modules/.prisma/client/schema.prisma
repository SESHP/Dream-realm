generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  username     String   @unique
  passwordHash String   @map("password_hash")
  createdAt    DateTime @default(now()) @map("created_at")

  character Character?
  village   Village?

  @@map("users")
}

model Character {
  id              String    @id @default(uuid())
  userId          String    @unique @map("user_id")
  x               Int       @default(0)
  y               Int       @default(0)
  currentZone     String    @default("shelter") @map("current_zone")
  currentAction   String?   @map("current_action")
  actionStartedAt DateTime? @map("action_started_at")
  actionTargetId  String?   @map("action_target_id")

  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  inventory Inventory?

  @@map("characters")
}

model Inventory {
  id                  String @id @default(uuid())
  characterId         String @unique @map("character_id")
  crystallizedDesires Float  @default(0) @map("crystallized_desires")
  essenceOblivion     Float  @default(0) @map("essence_oblivion")
  moonDust            Float  @default(0) @map("moon_dust")
  nightmareFragments  Float  @default(0) @map("nightmare_fragments")
  pureFear            Float  @default(0) @map("pure_fear")
  maxCapacity         Int    @default(50) @map("max_capacity")

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@map("inventories")
}

model Village {
  id                  String   @id @default(uuid())
  userId              String   @unique @map("user_id")
  crystallizedDesires Float    @default(0) @map("crystallized_desires")
  essenceOblivion     Float    @default(0) @map("essence_oblivion")
  moonDust            Float    @default(0) @map("moon_dust")
  nightmareFragments  Float    @default(0) @map("nightmare_fragments")
  pureFear            Float    @default(0) @map("pure_fear")
  maxStorage          Int      @default(100) @map("max_storage")
  lastCollectedAt     DateTime @default(now()) @map("last_collected_at")

  buildings Building[]
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("villages")
}

model Building {
  id                    String    @id @default(uuid())
  villageId             String    @map("village_id")
  type                  String
  level                 Int       @default(1)
  positionX             Int       @map("position_x")
  positionY             Int       @map("position_y")
  constructionStartedAt DateTime? @map("construction_started_at")
  constructionEndsAt    DateTime? @map("construction_ends_at")
  isConstructing        Boolean   @default(false) @map("is_constructing")

  village Village @relation(fields: [villageId], references: [id], onDelete: Cascade)

  @@map("buildings")
}

model MapResource {
  id        String    @id @default(uuid())
  type      String
  zone      String
  x         Int
  y         Int
  depleted  Boolean   @default(false)
  respawnAt DateTime? @map("respawn_at")

  @@map("map_resources")
}
